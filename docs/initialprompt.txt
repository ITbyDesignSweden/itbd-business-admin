Jag bygger min "ITBD Admin Portal".
Jag har redan genererat UI-komponenter och layout via v0.dev. Din uppgift är att strukturera om koden och koppla ihop den med min backend (Supabase).

Läs igenom dessa filer för kontext:
- @tech_stack.md (Tekniska regler)

Utför följande steg i turordning:

1. ANALYSERA & STRUKTURERA (Route Groups)
- Titta på koden från v0. Identifiera vad som är Layout (Sidebar/Header) och vad som är Dashboard-innehåll.
- Flytta Layout-komponenterna till `app/(dashboard)/layout.tsx`.
- Flytta Dashboard-innehållet till `app/(dashboard)/page.tsx`.
- Se till att `/login` ligger utanför `(dashboard)` så den inte får sidebaren.
- Mål: Appen ska starta snyggt med `npm run dev` och visa Dashboarden.

2. SUPABASE INFRASTRUKTUR
- Skapa `lib/supabase/client.ts` (Browser Client).
- Skapa `lib/supabase/server.ts` (Server Client med @supabase/ssr).
- Skapa `lib/supabase/middleware.ts` (Session refresh logic).
- Skapa `supabase/schema.sql` och klistra in SQL-koden jag ger dig sist i denna prompt.

3. KOPPLA AUTH
- Hitta inloggningssidan från v0 (eller skapa en om den saknas).
- Skapa en Server Action `actions/auth.ts` med funktionen `login`.
- Byt ut eventuella `console.log` i formuläret mot riktiga anrop till `login`-actionen.

4. KOPPLA DASHBOARD-DATA
- Dashboarden visar just nu hårdkodad data ("Lorem Ipsum", "12 credits").
- Skapa en Server Action (eller hämta direkt i page.tsx) som hämtar:
  a) Total MRR (Summera 'subscription_plan' värde från organizations).
  b) Lista på senaste 'organizations'.
- Byt ut mock-datan i UI:t mot riktig data från databasen.

VIKTIGT:
- Förstör inte designen! Behåll Tailwind-klasserna från v0.
- Använd "Use Server" actions för all datahämtning.
- Skriv strikt TypeScript.

Här är SQL-koden för databasen (ITBD Admin Schema):

-- 1. Organizations (Kunder)
create table public.organizations (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  name text not null,
  org_nr text,
  subscription_plan text default 'care' check (subscription_plan in ('care', 'growth', 'scale')),
  status text default 'pilot' check (status in ('pilot', 'active', 'churned'))
);

-- 2. Profiles (Admin Users)
create table public.profiles (
  id uuid references auth.users on delete cascade primary key,
  email text not null,
  full_name text,
  role text default 'admin' -- I admin-portalen är alla admins
);

-- 3. Credit Ledger (Centralbanken)
create table public.credit_ledger (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  org_id uuid references public.organizations(id) not null,
  amount integer not null, -- Positivt = Köp, Negativt = Förbrukning
  description text not null,
  project_id uuid
);

-- 4. Projects (Beställningar)
create table public.projects (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  org_id uuid references public.organizations(id) not null,
  title text not null,
  status text default 'backlog',
  cost_credits integer default 0
);

-- RLS
alter table public.organizations enable row level security;
alter table public.profiles enable row level security;
alter table public.credit_ledger enable row level security;
alter table public.projects enable row level security;

-- Admin Policy (Låt inloggade göra allt i detta interna system)
create policy "Admins can do everything" on organizations for all using (auth.role() = 'authenticated');
create policy "Admins can do everything" on profiles for all using (auth.role() = 'authenticated');
create policy "Admins can do everything" on credit_ledger for all using (auth.role() = 'authenticated');
create policy "Admins can do everything" on projects for all using (auth.role() = 'authenticated');